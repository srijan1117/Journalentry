@page "/login"
@using Journal.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="d-flex justify-content-center align-items-center vh-100 bg-light"
     style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000;">
    <div class="card shadow p-4" style="width: 350px;">
        <h3 class="text-center mb-4">Journal Login</h3>

        <EditForm Model="Model" OnValidSubmit="HandleLoginAsync">
            <DataAnnotationsValidator />

            <div class="mb-3">
                <label class="form-label">Username</label>
                <InputText class="form-control" @bind-Value="Model.Username" placeholder="admin" />
            </div>

            <div class="mb-3">
                <label class="form-label">Password</label>
                <InputText class="form-control" type="password" @bind-Value="Model.Password" placeholder="test" />
            </div>

            <button class="btn btn-primary w-100" type="submit">Login</button>
        </EditForm>
    </div>
</div>

@code {
    private LoginModel Model = new();

    private async Task HandleLoginAsync()
    {
        var ok = AuthService.Login(Model.Username, Model.Password);

        if (ok)
        {
            await Application.Current?.MainPage?.DisplayAlert("Welcome", "Login successful.", "OK");
            Navigation.NavigateTo("/", forceLoad: false);
        }
        else
        {
            await Application.Current?.MainPage?.DisplayAlert("Login Failed", "Invalid credentials.", "OK");
        }
    }

    private class LoginModel
    {
        public string Username { get; set; } = "";
        public string Password { get; set; } = "";
    }
}
